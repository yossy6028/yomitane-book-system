import React, { useState, useEffect } from 'react';
import './App.css';
import BookList from './components/BookList';
import AdminPanel from './components/AdminPanel';
import { UserProfile, recommendationService } from './services/recommendationService';
import { generateMixedTest, calculateTestResult, analyzeTestPerformance, MixedTestQuestion } from './data/mixedTestQuestions';

function App() {
  const [currentView, setCurrentView] = useState<'main' | 'books' | 'admin'>('main');
  const [currentStep, setCurrentStep] = useState(1);
  const [userProfile, setUserProfile] = useState<Partial<UserProfile>>({});

  const renderView = () => {
    switch(currentView) {
      case 'books':
        return <BookList onBack={() => setCurrentView('main')} />;
      case 'admin':
        return <AdminPanel onBack={() => setCurrentView('main')} />;
      case 'main':
      default:
        return renderMainSteps();
    }
  };

  const renderMainSteps = () => {
    switch(currentStep) {
      case 1:
        return <WelcomeStep 
          onNext={() => setCurrentStep(2)} 
          onViewBooks={() => setCurrentView('books')}
          onAdmin={() => setCurrentView('admin')}
        />;
      case 2:
        return <SurveyStep 
          onNext={() => setCurrentStep(3)} 
          onBack={() => setCurrentStep(1)}
          userProfile={userProfile}
          setUserProfile={setUserProfile}
        />;
      case 3:
        return <TestStep 
          onNext={() => setCurrentStep(4)} 
          onBack={() => setCurrentStep(2)}
          userProfile={userProfile}
          setUserProfile={setUserProfile}
        />;
      case 4:
        return <ResultsStep 
          userProfile={userProfile as UserProfile} 
          onBack={() => setCurrentStep(3)} 
          onRestart={() => setCurrentStep(1)} 
        />;
      default:
        return <WelcomeStep 
          onNext={() => setCurrentStep(2)} 
          onViewBooks={() => setCurrentView('books')}
          onAdmin={() => setCurrentView('admin')}
        />;
    }
  };

  return (
    <div className="App">
      <header className="App-header">
        <img src="/tanemo-logo.png" alt="TANEMO" className="tanemo-logo" />
        <h1>æœ¬ã®ãŠã™ã™ã‚ã‚·ã‚¹ãƒ†ãƒ </h1>
        <p>ãã¿ã«ã´ã£ãŸã‚Šã®æœ¬ã‚’è¦‹ã¤ã‘ã‚ˆã†ï¼</p>
      </header>
      <main className="App-main">
        {renderView()}
      </main>
    </div>
  );
}

// Welcome Step Component
const WelcomeStep: React.FC<{
  onNext: () => void;
  onViewBooks: () => void;
  onAdmin: () => void;
}> = ({ onNext, onViewBooks, onAdmin }) => (
  <div className="step-container">
    <h2>ğŸŒŸ ã¯ã˜ã‚ã«</h2>
    <p>ã“ã‚“ã«ã¡ã¯ï¼ã“ã®ã‚·ã‚¹ãƒ†ãƒ ã§ã¯ã€ãã¿ã®å¹´é½¢ã‚„å¥½ããªã“ã¨ã‚’æ•™ãˆã¦ã‚‚ã‚‰ã£ã¦ã€ã´ã£ãŸã‚Šã®æœ¬ã‚’ãŠã™ã™ã‚ã—ã¾ã™ã€‚</p>
    <p>ç°¡å˜ãªã‚¢ãƒ³ã‚±ãƒ¼ãƒˆã¨å°ã•ãªãƒ†ã‚¹ãƒˆãŒã‚ã‚‹ã‚ˆã€‚</p>
    
    <div className="welcome-buttons">
      <button className="primary-button" onClick={onNext}>
        ã¯ã˜ã‚ã‚‹ ğŸš€
      </button>
      
      <button className="secondary-button" onClick={onViewBooks}>
        ğŸ“š å›³æ›¸ä¸€è¦§ã‚’è¦‹ã‚‹
      </button>
      
      <button className="admin-button" onClick={onAdmin}>
        âš™ï¸ ç®¡ç†è€…ãƒ‘ãƒãƒ«
      </button>
    </div>
    
    <div className="welcome-features">
      <div className="feature-item">
        <span className="feature-icon">ğŸ¯</span>
        <span className="feature-text">ãã¿ã«ã‚ã£ãŸæœ¬ã‚’è¦‹ã¤ã‘ã‚‹</span>
      </div>
      <div className="feature-item">
        <span className="feature-icon">ğŸ“–</span>
        <span className="feature-text">ãŸãã•ã‚“ã®æœ¬ã‹ã‚‰é¸ã¹ã‚‹</span>
      </div>
      <div className="feature-item">
        <span className="feature-icon">ğŸ”„</span>
        <span className="feature-text">å®šæœŸçš„ã«æ–°ã—ã„æœ¬ãŒè¿½åŠ ã•ã‚Œã‚‹</span>
      </div>
    </div>
  </div>
);

// Survey Step Component  
const SurveyStep: React.FC<{
  onNext: () => void, 
  onBack: () => void,
  userProfile: Partial<UserProfile>,
  setUserProfile: (profile: Partial<UserProfile>) => void
}> = ({ onNext, onBack, userProfile, setUserProfile }) => {
  const [selectedInterests, setSelectedInterests] = useState<string[]>(userProfile.interests || []);
  const [age, setAge] = useState<number>(userProfile.age || 0);
  const [readingLevel, setReadingLevel] = useState<string>(userProfile.readingLevel || '');
  const [personality, setPersonality] = useState<string[]>(userProfile.personalityTraits || []);

  const handleNext = () => {
    setUserProfile({
      ...userProfile,
      age,
      interests: selectedInterests,
      readingLevel: readingLevel as 'å°å­¦æ ¡ä½å­¦å¹´' | 'å°å­¦æ ¡ä¸­å­¦å¹´' | 'å°å­¦æ ¡é«˜å­¦å¹´' | 'ä¸­å­¦ç”Ÿ' | 'ä¸­å­¦å—é¨“ãƒ¬ãƒ™ãƒ«' | 'é«˜æ ¡å—é¨“ãƒ¬ãƒ™ãƒ«',
      personalityTraits: personality
    });
    onNext();
  };

  const handleInterestChange = (interest: string, checked: boolean) => {
    if (checked) {
      setSelectedInterests([...selectedInterests, interest]);
    } else {
      setSelectedInterests(selectedInterests.filter(i => i !== interest));
    }
  };

  const handlePersonalityChange = (trait: string, checked: boolean) => {
    if (checked) {
      setPersonality([...personality, trait]);
    } else {
      setPersonality(personality.filter(t => t !== trait));
    }
  };

  return (
    <div className="step-container">
      <h2>ğŸ“ ã‚¢ãƒ³ã‚±ãƒ¼ãƒˆ</h2>
      
      <div className="form-group">
        <label>å¹´é½¢ã‚’æ•™ãˆã¦ã­:</label>
        <select value={age} onChange={(e) => setAge(Number(e.target.value))}>
          <option value={0}>é¸æŠã—ã¦ãã ã•ã„</option>
          {Array.from({length: 10}, (_, i) => i + 6).map(age => (
            <option key={age} value={age}>{age}æ­³</option>
          ))}
        </select>
      </div>

      <div className="form-group">
        <label>èˆˆå‘³ï¼ˆãã‚‡ã†ã¿ï¼‰ãŒã‚ã‚‹ã“ã¨ã¯ï¼Ÿ (ã„ãã¤ã§ã‚‚é¸ã‚“ã§ã­):</label>
        <div className="checkbox-group">
          {[
            'ã‚¹ãƒãƒ¼ãƒ„', 'éŸ³æ¥½', 'çµµã‚’æã', 'ã‚²ãƒ¼ãƒ ', 'å‹•ç‰©', 'ç§‘å­¦', 'æ–™ç†', 'å†’é™º',
            'èª­æ›¸', 'æ˜ ç”»ãƒ»ã‚¢ãƒ‹ãƒ¡', 'å·¥ä½œãƒ»æ‰‹èŠ¸', 'æ­´å²', 'å®‡å®™ãƒ»å¤©ä½“', 'ä¹—ã‚Šç‰©',
            'æ—…è¡Œãƒ»åœ°ç†', 'æ¨ç†ãƒ»è¬è§£ã', 'ãƒ•ã‚¡ãƒ³ã‚¿ã‚¸ãƒ¼', 'å‹æƒ…ãƒ»æ‹æ„›', 'å®¶æ—', 'å­¦æ ¡ç”Ÿæ´»'
          ].map(interest => (
            <label key={interest} className="checkbox-label">
              <input 
                type="checkbox" 
                checked={selectedInterests.includes(interest)}
                onChange={(e) => handleInterestChange(interest, e.target.checked)}
              />
              {interest}
            </label>
          ))}
        </div>
      </div>

      <div className="form-group">
        <label>èª­æ›¸ã®ãƒ¬ãƒ™ãƒ«ã¯ï¼Ÿ:</label>
        <select value={readingLevel} onChange={(e) => setReadingLevel(e.target.value)}>
          <option value="">é¸æŠã—ã¦ãã ã•ã„</option>
          <option value="å°å­¦æ ¡ä½å­¦å¹´">ä½å­¦å¹´ãƒ¬ãƒ™ãƒ«ï¼ˆã²ã‚‰ãŒãªãŒå¤šã„æœ¬ï¼‰</option>
          <option value="å°å­¦æ ¡ä¸­å­¦å¹´">ä¸­å­¦å¹´ãƒ¬ãƒ™ãƒ«ï¼ˆæ¼¢å­—ã¾ã˜ã‚Šã®æœ¬ï¼‰</option>
          <option value="å°å­¦æ ¡é«˜å­¦å¹´">é«˜å­¦å¹´ãƒ¬ãƒ™ãƒ«ï¼ˆå°‘ã—é›£ã—ã„æœ¬ï¼‰</option>
          <option value="ä¸­å­¦ç”Ÿ">ä¸­å­¦ç”Ÿãƒ¬ãƒ™ãƒ«ï¼ˆé›£ã—ã„æœ¬ã‚‚OKï¼‰</option>
          <option value="ä¸­å­¦å—é¨“ãƒ¬ãƒ™ãƒ«">ä¸­å­¦å—é¨“ãƒ¬ãƒ™ãƒ«ï¼ˆé«˜å­¦å¹´ã€œä¸­å­¦ç”Ÿå‘ã‘ï¼‰</option>
          <option value="é«˜æ ¡å—é¨“ãƒ¬ãƒ™ãƒ«">é«˜æ ¡å—é¨“ãƒ¬ãƒ™ãƒ«ï¼ˆä¸­å­¦ãƒã‚¤ãƒ¬ãƒ™ãƒ«ï¼‰</option>
        </select>
      </div>

      <div className="form-group">
        <label>ãã¿ã®æ€§æ ¼ã¯ï¼Ÿ (ã„ãã¤ã§ã‚‚é¸ã‚“ã§ã­):</label>
        <div className="checkbox-group">
          {[
            'å‹‡æ•¢', 'å„ªã—ã„', 'å¥½å¥‡å¿ƒæ—ºç››', 'æ´»ç™º', 'èŠ¸è¡“çš„', 'æ€ã„ã‚„ã‚Š', 'è«–ç†çš„', 'ãƒ¦ãƒ¼ãƒ¢ã‚¢å¥½ã',
            'æ…é‡', 'ç¤¾äº¤çš„', 'å†…å‘çš„', 'å‰µé€ çš„', 'è²¬ä»»æ„ŸãŒå¼·ã„', 'è‡ªç«‹ã—ã¦ã„ã‚‹', 'å”èª¿æ€§ãŒã‚ã‚‹', 'ãƒªãƒ¼ãƒ€ãƒ¼ã‚·ãƒƒãƒ—ãŒã‚ã‚‹',
            'æ„Ÿå—æ€§ãŒè±Šã‹', 'é›†ä¸­åŠ›ãŒã‚ã‚‹', 'å†’é™ºå¥½ã', 'å¹³å’Œä¸»ç¾©'
          ].map(trait => (
            <label key={trait} className="checkbox-label">
              <input 
                type="checkbox" 
                checked={personality.includes(trait)}
                onChange={(e) => handlePersonalityChange(trait, e.target.checked)}
              />
              {trait}
            </label>
          ))}
        </div>
      </div>

      <div className="button-group">
        <button className="secondary-button" onClick={onBack}>ã‚‚ã©ã‚‹</button>
        <button 
          className="primary-button" 
          onClick={handleNext}
          disabled={!age || selectedInterests.length === 0 || !readingLevel}
        >
          ã¤ãã¸
        </button>
      </div>
    </div>
  );
};

// Test Step Component
const TestStep: React.FC<{
  onNext: () => void, 
  onBack: () => void,
  userProfile: Partial<UserProfile>,
  setUserProfile: (profile: Partial<UserProfile>) => void
}> = ({ onNext, onBack, userProfile, setUserProfile }) => {
  const [answers, setAnswers] = useState<{[key: string]: string}>({});
  const [questions, setQuestions] = useState<MixedTestQuestion[]>([]);

  useEffect(() => {
    // å¹´é½¢ã«å¿œã˜ãŸèªå½™+å¸¸è­˜ã®æ··åˆãƒ†ã‚¹ãƒˆã‚’ç”Ÿæˆï¼ˆèªå½™5å• + å¸¸è­˜5å•ï¼‰
    const mixedQuestions = generateMixedTest(userProfile.age || 10, 5, 5);
    setQuestions(mixedQuestions);
    setAnswers({}); // å•é¡ŒãŒå¤‰ã‚ã£ãŸã‚‰å›ç­”ã‚’ãƒªã‚»ãƒƒãƒˆ
  }, [userProfile.age]);

  // å•é¡ŒãŒèª­ã¿è¾¼ã¾ã‚Œã¦ã„ãªã„å ´åˆã®ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯
  if (questions.length === 0) {
    return (
      <div className="step-container">
        <h2>ğŸ§  {userProfile.age}æ­³å‘ã‘ãƒ†ã‚¹ãƒˆ</h2>
        <p>å•é¡Œã‚’æº–å‚™ã—ã¦ã„ã¾ã™...</p>
        <div className="button-group">
          <button className="secondary-button" onClick={onBack}>ã‚‚ã©ã‚‹</button>
        </div>
      </div>
    );
  }

  const handleNext = () => {
    // æ–°ã—ã„ç·åˆãƒ†ã‚¹ãƒˆçµæœè¨ˆç®—
    const testResult = calculateTestResult(questions, answers, userProfile.age || 10);
    const analysis = analyzeTestPerformance(testResult);
    
    setUserProfile({
      ...userProfile,
      vocabularyScore: testResult.overallLevel, // ç·åˆãƒ¬ãƒ™ãƒ«ã‚’èªå½™ã‚¹ã‚³ã‚¢ã¨ã—ã¦ä½¿ç”¨
      testResult: testResult, // è©³ç´°ãªçµæœã‚‚ä¿å­˜
      testAnalysis: analysis // åˆ†æçµæœã‚‚ä¿å­˜
    });
    onNext();
  };

  return (
    <div className="step-container">
      <h2>ğŸ§  {userProfile.age}æ­³å‘ã‘ç·åˆãƒ†ã‚¹ãƒˆ</h2>
      <p>{userProfile.age}æ­³ã®ãã¿ã®èªå½™åŠ›ã¨å¸¸è­˜åŠ›ã‚’ãƒã‚§ãƒƒã‚¯ã™ã‚‹ã‚ˆï¼å…¨éƒ¨ã§{questions.length}å•ã§ã™ã€‚</p>
      <p className="test-info">ğŸ’¡ èªå½™åŠ›ã¨å¸¸è­˜åŠ›ã®ä¸¡æ–¹ã‚’æ¸¬å®šã—ã€å•é¡Œã¯æ¯å›ãƒ©ãƒ³ãƒ€ãƒ ã«å¤‰ã‚ã‚Šã¾ã™</p>
      
      {questions.map((q, index) => (
        <div key={q.id} className="question">
          <div className="question-header">
            <p><strong>å•é¡Œ{index + 1}:</strong> {q.question}</p>
            <span className={`question-type ${q.type}`}>
              {q.type === 'vocabulary' ? 'ğŸ“èªå½™' : 'ğŸ§­å¸¸è­˜'}
            </span>
          </div>
          <div className="radio-group">
            {q.options.map((option, optIndex) => (
              <label key={optIndex}>
                <input 
                  type="radio" 
                  name={q.id} 
                  value={optIndex}
                  checked={answers[q.id] === optIndex.toString()}
                  onChange={(e) => setAnswers({...answers, [q.id]: e.target.value})}
                /> 
                {option}
              </label>
            ))}
          </div>
        </div>
      ))}
      
      <div className="button-group">
        <button className="secondary-button" onClick={onBack}>ã‚‚ã©ã‚‹</button>
        <button 
          className="primary-button" 
          onClick={handleNext}
          disabled={Object.keys(answers).length < questions.length}
        >
          çµæœã‚’è¦‹ã‚‹
        </button>
      </div>
    </div>
  );
};

// Results Step Component
const ResultsStep: React.FC<{
  userProfile: UserProfile,
  onBack: () => void, 
  onRestart: () => void
}> = ({ userProfile, onBack, onRestart }) => {
  const [recommendations, setRecommendations] = useState<any[]>([]);
  const [selectedBook, setSelectedBook] = useState<any>(null);
  const [isLoading, setIsLoading] = useState(false);

  useEffect(() => {
    const fetchRecommendations = async () => {
      setIsLoading(true);
      try {
        const recs = await recommendationService.getRecommendations(userProfile, 3);
        setRecommendations(recs);
      } catch (error) {
        console.error('æ¨è–¦å–å¾—ã‚¨ãƒ©ãƒ¼:', error);
        setRecommendations([]);
      } finally {
        setIsLoading(false);
      }
    };

    fetchRecommendations();
  }, [userProfile]);

  const getReadingLevelLabel = (level: string) => {
    switch (level) {
      case 'å°å­¦æ ¡ä½å­¦å¹´': return 'ä½å­¦å¹´ãƒ¬ãƒ™ãƒ«';
      case 'å°å­¦æ ¡ä¸­å­¦å¹´': return 'ä¸­å­¦å¹´ãƒ¬ãƒ™ãƒ«';
      case 'å°å­¦æ ¡é«˜å­¦å¹´': return 'é«˜å­¦å¹´ãƒ¬ãƒ™ãƒ«';
      case 'ä¸­å­¦ç”Ÿ': return 'ä¸­å­¦ç”Ÿãƒ¬ãƒ™ãƒ«';
      case 'ä¸­å­¦å—é¨“ãƒ¬ãƒ™ãƒ«': return 'ä¸­å­¦å—é¨“ãƒ¬ãƒ™ãƒ«';
      case 'é«˜æ ¡å—é¨“ãƒ¬ãƒ™ãƒ«': return 'é«˜æ ¡å—é¨“ãƒ¬ãƒ™ãƒ«';
      // æ—§å½¢å¼ã¨ã®äº’æ›æ€§
      case 'elementary-low': return 'ä½å­¦å¹´ãƒ¬ãƒ™ãƒ«';
      case 'elementary-mid': return 'ä¸­å­¦å¹´ãƒ¬ãƒ™ãƒ«';
      case 'elementary-high': return 'é«˜å­¦å¹´ãƒ¬ãƒ™ãƒ«';
      case 'junior-high': return 'ä¸­å­¦ç”Ÿãƒ¬ãƒ™ãƒ«';
      default: return level;
    }
  };

  const getStarRating = (rating: number) => {
    return 'â­'.repeat(Math.floor(rating)) + 'â˜†'.repeat(5 - Math.floor(rating));
  };

  return (
    <div className="step-container">
      <h2>ğŸ‰ {userProfile.age}æ­³ã®ãã¿ã«ãŠã™ã™ã‚ã®æœ¬</h2>
      
      <div className="user-summary">
        <h3>ğŸ“‹ ãã¿ã®ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«</h3>
        <div className="profile-summary">
          <span className="profile-item">å¹´é½¢: {userProfile.age}æ­³</span>
          <span className="profile-item">èª­æ›¸ãƒ¬ãƒ™ãƒ«: {getReadingLevelLabel(userProfile.readingLevel)}</span>
          <span className="profile-item">ç·åˆãƒ¬ãƒ™ãƒ«: {userProfile.vocabularyScore}/10</span>
          {userProfile.testResult && (
            <>
              <span className="profile-item">èªå½™åŠ›: {userProfile.testResult.vocabularyScore}/100</span>
              <span className="profile-item">å¸¸è­˜åŠ›: {userProfile.testResult.commonSenseScore}/100</span>
            </>
          )}
        </div>
        <div className="profile-interests">
          <strong>å¥½ããªã“ã¨:</strong> {userProfile.interests.join('ãƒ»')}
        </div>
        {userProfile.personalityTraits.length > 0 && (
          <div className="profile-personality">
            <strong>æ€§æ ¼:</strong> {userProfile.personalityTraits.join('ãƒ»')}
          </div>
        )}
        
      </div>

      <div className="recommendations">
        <h3>ğŸ“š ãã¿ã«ã´ã£ãŸã‚Šã®æœ¬ ({recommendations.length}å†Š)</h3>
        
        {isLoading ? (
          <div className="loading">
            <p>ğŸ” ãã¿ã«ã´ã£ãŸã‚Šã®æœ¬ã‚’æ¢ã—ã¦ã„ã¾ã™...</p>
            <div className="spinner">ğŸŒŸ</div>
          </div>
        ) : recommendations.length === 0 ? (
          <div className="no-recommendations">
            <p>ç”³ã—è¨³ã‚ã‚Šã¾ã›ã‚“ã€‚ç¾åœ¨ã®å›³æ›¸ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã§ã¯ã€ãã¿ã®ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ã«åˆã†æœ¬ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚</p>
            <p>ç®¡ç†è€…ãƒ‘ãƒãƒ«ã‹ã‚‰å›³æ›¸æ›´æ–°ã‚’è¡Œã†ã¨ã€ã‚ˆã‚Šå¤šãã®æœ¬ãŒè¦‹ã¤ã‹ã‚‹ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã€‚</p>
          </div>
        ) : (
          <div className="recommendation-list">
            {recommendations.map((rec, index) => (
              <div 
                key={rec.book.id} 
                className={`recommendation-card ${selectedBook?.book?.id === rec.book.id ? 'selected' : ''}`}
                onClick={() => setSelectedBook(selectedBook?.book?.id === rec.book.id ? null : rec)}
              >
                <div className="recommendation-header">
                  <div className="book-basic-info">
                    <h4>#{index + 1} ã€Œ{rec.book.title}ã€</h4>
                    <p className="book-author">è‘—è€…: {rec.book.author}</p>
                    <div className="book-meta-compact">
                      <span className="age-range">{rec.book.ageRange.min}-{rec.book.ageRange.max}æ­³</span>
                      <span className="reading-level">{getReadingLevelLabel(rec.book.readingLevel)}</span>
                      <span className="rating">{getStarRating(rec.book.rating)}</span>
                      <span className="match-score">ãƒãƒƒãƒåº¦: {Math.round(rec.score)}%</span>
                    </div>
                  </div>
                  {rec.book.coverImage && (
                    <img src={rec.book.coverImage} alt={rec.book.title} className="recommendation-cover" />
                  )}
                </div>

                <div className="recommendation-reasons">
                  <strong>ğŸ“ ãŠã™ã™ã‚ã®ç†ç”±:</strong>
                  <ul>
                    {rec.reasons.map((reason: string, i: number) => (
                      <li key={i}>{reason}</li>
                    ))}
                  </ul>
                </div>

                {selectedBook?.book?.id === rec.book.id && (
                  <div className="book-details">
                    <div className="book-description">
                      <strong>ğŸ“– ã‚ã‚‰ã™ã˜:</strong>
                      <p>{rec.book.description}</p>
                    </div>
                    
                    <div className="book-categories">
                      <strong>ğŸ·ï¸ ã‚¸ãƒ£ãƒ³ãƒ«:</strong>
                      {rec.book.categories.map((cat: string) => (
                        <span key={cat} className="category-tag">{cat}</span>
                      ))}
                    </div>

                    <div className="book-interests">
                      <strong>ğŸ¯ èˆˆå‘³åˆ†é‡:</strong>
                      {rec.book.interests.map((interest: string) => (
                        <span key={interest} className="interest-tag">{interest}</span>
                      ))}
                    </div>

                    <div className="detailed-match">
                      <strong>ğŸ” è©³ç´°ãƒãƒƒãƒåˆ†æ:</strong>
                      <div className="match-indicators">
                        <span className={`match-indicator ${rec.matchDetails.ageMatch ? 'match' : 'no-match'}`}>
                          å¹´é½¢: {rec.matchDetails.ageMatch ? 'âœ…' : 'âŒ'}
                        </span>
                        <span className={`match-indicator ${rec.matchDetails.levelMatch ? 'match' : 'no-match'}`}>
                          ãƒ¬ãƒ™ãƒ«: {rec.matchDetails.levelMatch ? 'âœ…' : 'âŒ'}
                        </span>
                        <span className={`match-indicator ${rec.matchDetails.vocabularyMatch ? 'match' : 'no-match'}`}>
                          èªå½™åŠ›: {rec.matchDetails.vocabularyMatch ? 'âœ…' : 'âŒ'}
                        </span>
                        <span className={`match-indicator ${rec.matchDetails.interestMatch.length > 0 ? 'match' : 'no-match'}`}>
                          èˆˆå‘³: {rec.matchDetails.interestMatch.length > 0 ? 'âœ…' : 'âŒ'}
                        </span>
                      </div>
                    </div>

                    {rec.book.pageCount && (
                      <div className="reading-time">
                        <strong>ğŸ“„ ãƒšãƒ¼ã‚¸æ•°:</strong> ç´„{rec.book.pageCount}ãƒšãƒ¼ã‚¸
                      </div>
                    )}
                  </div>
                )}

                <div className="click-hint">
                  {selectedBook?.book?.id === rec.book.id ? 'â–² ã‚¯ãƒªãƒƒã‚¯ã—ã¦é–‰ã˜ã‚‹' : 'â–¼ ã‚¯ãƒªãƒƒã‚¯ã—ã¦è©³ç´°ã‚’è¦‹ã‚‹'}
                </div>
              </div>
            ))}
          </div>
        )}
      </div>

      <div className="button-group">
        <button className="secondary-button" onClick={onBack}>ã‚‚ã©ã‚‹</button>
        <button className="primary-button" onClick={onRestart}>ã‚‚ã†ä¸€åº¦ã‚„ã‚‹</button>
      </div>
    </div>
  );
};

export default App;

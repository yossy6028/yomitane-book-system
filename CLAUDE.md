# 書籍推薦システム運用ルール

## 📚 【最重要】標準タグ辞書システム（2025年7月22日制定）

### 📋 標準タグ辞書の厳格運用
**標準タグ辞書に登録されたタグのみ使用可能。存在しないタグは使用禁止。**

#### ❶ ジャンル（大枠）- categories
- 小説
- 児童文学
- ミステリー／推理
- ファンタジー
- ＳＦ
- 歴史・時代
- 恋愛
- ホラー
- 冒険
- ノンフィクション
- 伝記・自伝
- エッセイ／随筆
- 詩
- 戯曲
- 絵本
- グラフィックノベル／漫画

#### ❷ 題材・分野 - interest_tags
- 科学
- テクノロジー
- 自然
- 動物
- 植物
- 宇宙
- 環境
- 歴史
- 地理・旅行
- 社会
- 政治
- 経済
- 文化
- 芸術
- 音楽
- スポーツ
- 料理・食
- 心理
- 哲学
- 宗教
- 民俗

#### ❸ テーマ・モチーフ - theme_tags
- 友情
- 家族
- 成長・自立
- 多様性・共生
- いじめ
- 勇気
- 希望
- 正義
- 犠牲
- 戦争と平和
- 環境保護
- 自己発見
- 障がい
- 老い
- 死と生
- 移民・ルーツ
- 社会正義
- ジェンダー

### 🎯 タグ付けルール
1. **辞書外タグの絶対禁止**: 上記リストにないタグは一切使用不可
2. **タイトル・あらすじからの抽出**: 書籍のタイトルと説明文から該当するタグを選択
3. **タグ数の制限**: 
   - categories: 1-2個
   - interest_tags: 1-3個
   - theme_tags: 0-2個
4. **機械的判定の優先**: 主観を排除し、テキストマッチングで判定

### 📌 実装ファイル
- 標準タグ辞書: `/src/data/standardTagDictionary.json`
- 適用スクリプト: `/scripts/resetToStandardTagsOnly.js`

---

## 🚨 【緊急改定】書籍分類の根本的見直し（2025年7月21日 重大問題対応）

### 📋 発見された重大問題
**前回のタグ付け作業で37件の「ノンフィクション矛盾」が判明**
- フィクション作品（小説・物語）を「ノンフィクション」に分類
- 8-10歳対象書籍に「恋愛」テーマを不適切付与
- 著名作品の基本的性質を無視した機械的分類

### 📚 フィクション/ノンフィクション厳密判定基準

#### A. **ノンフィクション（事実に基づく作品）**
**必須条件**: 以下ALL満たす場合のみ
1. **事実性**: 実在の人物・出来事・現象を扱う
2. **情報性**: 読者の知識獲得が主目的
3. **検証可能性**: 内容の真偽を確認できる

**確実なノンフィクション例**:
- 伝記：「窓ぎわのトットちゃん」（黒柳徹子の実体験記録）
- 科学書：「ファーブル昆虫記」（観察に基づく研究記録）  
- 歴史書：「13歳のきみと、戦国時代の話をしよう」（歴史事実の解説）
- 図鑑：「せいめいのれきし」（科学的事実の体系化）

#### B. **フィクション（創作作品）**
**判定条件**: 以下ANY該当で即座にフィクション
1. **創作性**: 架空の人物・設定・出来事
2. **物語性**: プロット・キャラクター展開が主軸
3. **想像性**: 現実にない要素（魔法・未来・異世界）

**確実なフィクション例**:
- 物語：「赤毛のアン」「若草物語」「小公女」（架空の人物の物語）
- ファンタジー：「ハリー・ポッター」「モモ」「ゲド戦記」
- 童話：「ごんぎつね」「注文の多い料理店」（創作された物語）

### 🎯 新カテゴリー体系（完全改定版）

#### 第1階層：メディア形式（技術的分類）
- `絵本` - 絵が主体の幼児向け形式
- `図鑑` - 体系的情報整理形式
- `詩集` - 詩歌形式
- その他は内容で分類

#### 第2階層：内容性質（本質的分類・排他的）
**ノンフィクション系**:
- `伝記` - 実在人物の生涯記録
- `科学` - 自然現象・研究の解説
- `歴史` - 過去の事実・時代解説
- `エッセイ` - 著者の実体験・思想

**フィクション系**:
- `ファンタジー` - 魔法・超自然要素
- `SF` - 科学技術・未来設定
- `ミステリー` - 謎解き・推理
- `冒険` - 探検・危険な旅
- `童話` - 教訓的な創作物語
- `民話` - 各地域の伝承物語
- `現代小説` - 現代を舞台とした創作

### 🏷️ テーマ割り当ての厳格ルール

#### 1. **年齢適合性（絶対条件）**
```
6-8歳:   友情、家族愛、自然、動物
9-11歳:  +成長物語、困難の克服、学校生活
12-15歳: +恋愛、哲学、社会問題、人権
```
**絶対禁止**: 8歳以下に「恋愛」「死生観」「戦争」

#### 2. **内容検証の必須プロセス**
```
【Step1】 タイトル・著者から基本性質判定
【Step2】 あらすじ・内容説明で詳細確認  
【Step3】 対象年齢・出版社情報で妥当性検証
【Step4】 同名作品の一般的評価・分類と照合
```

#### 3. **テーマ選択基準（厳格適用）**
- **主要テーマ**: 物語の核心部分（2-3個必須）
- **副次テーマ**: 付随的要素（0-1個まで）
- **禁止事項**: 機械的推測、曖昧な包括テーマ

### 🔧 品質保証プロセス

#### **Phase1: 自動チェック**
- フィクション作品のノンフィクション分類 → エラー
- 低年齢向け作品の不適切テーマ → エラー  
- 著名作品の常識外れ分類 → 警告

#### **Phase2: 人的検証**
- エラー・警告対象の全件再調査
- 修正前後の変更理由明記
- サンプリング検証（10%抜き取り）

#### **Phase3: 継続監視**
- ユーザー報告への即座対応
- 月次での分類精度測定
- 不適切タグの定期洗い出し

### ❌ 絶対的禁止事項（レッドライン）

1. **フィクションのノンフィクション分類**
2. **8歳以下への「恋愛」テーマ**
3. **著名作品の常識無視分類**
4. **推測・憶測による機械的補完**
5. **Web調査なしのタグ変更**

---

## 🚨 【最重要】書籍タグ付与の必須プロセス（2025年7月21日制定）

### 📋 絶対厳守ルール
**書籍の実際の内容を確認せずにタグを付与することを完全に禁止します。**

#### 必須実行プロセス（例外なし）:
1. **Web検索による内容確認**（必須）
   - 出版社の公式情報確認
   - Amazon・楽天ブックスでの詳細確認
   - 読者レビューの確認
   - 図書館サイトでの分類確認

2. **調査ログの記録**（必須）
   - 検索したURL
   - 確認した内容の要約
   - タグ判定の具体的根拠
   - 除外したタグとその理由

3. **内容に基づく厳格なタグ判定**（必須）
   - 推測・憶測による判定の禁止
   - 機械的補完の禁止
   - 実際の内容のみに基づく判定

#### 絶対禁止事項:
- ❌ 内容確認なしのタグ付与
- ❌ 機械的な代替タグの追加
- ❌ 「削除→適当なタグ補完」の繰り返し
- ❌ 推測に基づくタグ判定

#### 処理停止条件:
- Web検索で十分な情報が得られない場合
- 内容が不明確でタグ判定が困難な場合
- 情報源が信頼できない場合

**詳細プロセス**: `BOOK_TAGGING_MANDATORY_PROCESS.md` を参照

## 🔄 【緊急】全書籍完全調査システム（2025年7月21日制定）

### 📋 完全実行ルール
**全書籍196冊の100%内容確認と今後の例外なき調査を必須とします。**

#### 既存書籍の完全調査（必須完了）:
- ✅ 全196冊のWeb検索による内容確認
- ✅ 調査結果の完全記録・トレーサビリティ確保
- ✅ 実際の内容のみに基づくタグ再判定
- ✅ 品質検証・ユーザー確認

#### 新規書籍追加時の厳格ルール（例外なし）:
- ❌ 内容調査なしの書籍追加を技術的に不可能化
- ✅ 最低3つの情報源による内容確認
- ✅ 調査ログの完全記録
- ✅ タグ判定根拠の明文化

#### システム品質保証:
- 調査完了率: 100%必須
- ログ記録率: 100%必須
- タグ適正率: 95%以上
- ユーザー指摘率: 5%以下

**詳細システム**: `COMPREHENSIVE_BOOK_CONTENT_VERIFICATION_SYSTEM.md` を参照

**「数件のテストのみ」による表面的対応を完全に禁止し、全書籍の徹底調査を実現します。**

---

## 🚀 タスク完了後の必須サーバー起動ルール（2025年7月19日制定）

### 背景
タスク完了報告後、`npm start`でサーバーを起動してもERR_CONNECTION_REFUSEDエラーが頻発し、ユーザーがシステムにアクセスできない問題が発生。

### 必須実行手順
1. **タスク完了後は必ずサーバーを起動**
2. **起動確認まで完了してからタスク終了報告**
3. **アクセス可能なURLを提供**

### 実行コマンド
```bash
# 開発サーバー起動（バックグラウンド実行）
npm start &

# ポート確認
lsof -i :3000

# アクセステスト
curl -I http://localhost:3000
```

### 確認事項
- [ ] サーバーが正常に起動している
- [ ] ポート3000がリッスン状態である
- [ ] ブラウザでアクセス可能である
- [ ] エラーが発生していない

### トラブルシューティング
- **ポート競合**: `lsof -ti:3000 | xargs kill -9`でプロセス終了
- **別ポート使用**: `PORT=3001 npm start`で代替ポート
- **キャッシュクリア**: `npm start -- --reset-cache`

**重要**: タスク完了報告前に必ずサーバー起動とアクセス確認を完了すること

## 🎯 対象年齢範囲（2025年7月18日制定）
**6-15歳向けの中学受験推薦図書システム**
- 対象年齢: 6歳（小学校1年生）〜15歳（中学3年生）
- 高校生向け書籍（16歳以上）は対象外として削除
- 年齢設定は以下の範囲内で設定：
  - 小学校低学年: 6-8歳
  - 小学校中学年: 8-10歳  
  - 小学校高学年: 10-12歳
  - 中学受験-中学生: 12-15歳
  - 中学生: 13-15歳

---

## 🚀 【重要】3軸分類システムへの大規模改革（2025年7月22日制定）

### 📋 背景と経緯
Geminiとの批判的議論を通じて、単純な「年齢別タグシステム」から、子どもの多様な本の探し方に対応できる「3軸分類システム」へと進化させました。

### 🎯 新3軸分類システム

#### 1. **subject_areas（学問領域）**
本の学術的・教育的分野を示す軸
- 例: `biology`（生物学）、`physics`（物理学）、`history`（歴史）、`geography`（地理）
- 用途: 「理科の自由研究の参考にしたい」「歴史に興味が出てきた」など学習目的の検索

#### 2. **interest_tags（具体的な興味）**
子どもが本を手に取る「きっかけ」となる具体的な要素
- 例: `動物`、`魔法`、`学校`、`恐竜`、`宇宙`、`料理`
- 用途: 「恐竜の本が読みたい」「魔法が出てくる話」など直感的な検索

#### 3. **theme_tags（抽象的なテーマ）**
本を通じて読者が感じ取る感情や考えさせられる概念
- 例: `友情`、`成長物語`、`家族愛`、`自己発見`、`困難の克服`
- 用途: 「友情について考えたい」「成長する話が読みたい」など内面的な検索

### 📊 実装結果（2025年7月22日完了）
- **Phase 1.5**: subject_areas追加（76冊に学問領域を設定）
- **Phase 2**: reading_level追加（全196冊に1-5の読解レベル付与）とタグ分離完了
- **interest_tags充実化**: 55冊（42.3%）のinterest_tagsを自動充実化

### 🔧 データ構造例
```json
{
  "title": "銀河鉄道の夜",
  "categories": ["童話"],
  "subject_areas": [],
  "reading_level": 3,
  "interest_tags": ["汽車", "星", "祭り"],
  "theme_tags": ["友情", "死生観", "自己犠牲"]
}
```

### 📈 品質指標
- **reading_level分布**: Level 2(13冊)、Level 3(156冊)、Level 4(27冊)
- **平均タグ数**: interest_tags 0.8個/冊、theme_tags 2.0個/冊
- **subject_areas設定率**: 38.8%（76/196冊）

### 🚨 移行時の注意事項
1. **既存のinterestsフィールドは削除**: 新しい3軸に完全移行
2. **TypeScript型定義の更新必須**: Book.tsインターフェースに新フィールド追加
3. **UIとAPIの更新が必要**: 新構造に対応した検索ロジックの実装

### 🎯 今後の課題
1. **interest_tagsの継続的充実**: Web検索による内容確認で残り75冊を改善
2. **vocabulary_level導入検討**: 語彙レベルを第4の軸として追加
3. **検索UIの最適化**: 3軸を活用した直感的な検索インターフェース

**重要**: この変更により「正しいタグ付けをして子どもの現在の興味関心・読解レベルに合った本を提案する」という本来の目的に大きく前進しました。

---

## 📚 【テーマタグ付けルール】（2025年7月22日制定）

### 📋 テーマタグ付けの基本方針
全書籍にテーマタグを付与し、読者が本を通じて感じ取る感情や考えさせられる概念を明確化します。

### 🎯 テーマタグ決定プロセス

#### 1. **カテゴリーベースの基本テーマ**
各カテゴリーに応じた標準的なテーマを基準として使用：
- 児童文学: 成長・自立、友情
- ファンタジー: 勇気、友情、希望
- ミステリー／推理: 正義、勇気
- 冒険: 勇気、友情、成長・自立
- ノンフィクション: 自己発見
- 伝記・自伝: 成長・自立、勇気
- エッセイ／随筆: 自己発見
- 恋愛: 友情、成長・自立
- ホラー: 勇気、友情
- 歴史・時代: 正義、勇気
- ＳＦ: 希望、友情
- 絵本: 家族、友情

#### 2. **説明文からのテーマ抽出**
書籍の説明文に含まれるキーワードからテーマを判定：
- 友達・友人・仲間 → 友情
- 家族・親子・兄弟姉妹 → 家族
- 成長・大人・思春期 → 成長・自立
- 勇気・挑戦・冒険 → 勇気
- 希望・夢・未来 → 希望
- 正義・悪・守る → 正義
- 戦争・平和 → 戦争と平和
- 環境・自然・地球 → 環境保護
- 障害・障がい → 障がい
- 死・生き・命 → 死と生
- いじめ・孤独 → いじめ
- 犠牲・献身 → 犠牲
- 多様性・違い・理解 → 多様性・共生
- 社会・差別 → 社会正義
- 自分・発見・気づき → 自己発見

#### 3. **特定書籍への個別対応**
以下のような特定の書籍には、その内容に応じた適切なテーマを個別設定：
- 100万回生きたねこ: 死と生、家族、自己発見
- 窓ぎわのトットちゃん: 成長・自立、多様性・共生、友情
- アンネの日記: 戦争と平和、希望、勇気
- かいけつゾロリ: 友情、勇気、正義
- ナルニア国物語: 勇気、正義、友情
- アルジャーノンに花束を: 自己発見、希望、障がい

### 📊 テーマタグ付けの実績
- 全196冊に100%テーマタグ設定完了
- 最頻出テーマ: 友情（110冊）、成長・自立（84冊）、勇気（72冊）
- 1冊あたり平均2.0個のテーマタグ付与

### 🔧 実装ファイル
- タグ追加スクリプト: `/scripts/addThemeTagsToAllBooks.js`
- 最終調整スクリプト: `/scripts/addThemeTagsToFinalBooks.js`
- 検証スクリプト: `/scripts/verifyThemeTags.js`

### ⚠️ 注意事項
- 標準タグ辞書の `themes` に登録されたタグのみ使用可能
- 1冊につき最大3個まで（通常は2-3個を推奨）
- 年齢適合性を考慮（低年齢向けには「死と生」「戦争と平和」などは慎重に）